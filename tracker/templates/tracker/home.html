<!-- tracker/templates/tracker/home.html -->
<!DOCTYPE html>
<html>
<head>
    <title>Expense Tracker</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body class="bg-light">
    <div class="container py-4">
        <h1 class="text-center mb-4">üí∞ Expense Tracker</h1>

        <!-- Dark Mode Toggle -->
        <div class="text-end mb-3">
            <button id="toggle-theme" class="btn btn-outline-dark btn-sm">üåô Dark Mode</button>
        </div>


        <!-- Search Form -->
        <form method="get" class="mb-3 row">
            <div class="col-md-10">
                <input type="text" name="search" class="form-control" placeholder="Search description..." value="{{ request.GET.search|default:'' }}">
            </div>
            <div class="col-md-2 d-grid">
                <button type="submit" class="btn btn-dark">Search</button>
            </div>
        </form>

        <!-- Filter Form -->
        <div class="card mb-4">
            <div class="card-body">
                <form method="get" class="row g-3 align-items-end">
                    <div class="col-md-3">
                        <label class="form-label">Category</label>
                        <select class="form-select" name="category">
                            <option {% if selected_category == "All" %}selected{% endif %}>All</option>
                            <option value="Food" {% if selected_category == "Food" %}selected{% endif %}>Food</option>
                            <option value="Salary" {% if selected_category == "Salary" %}selected{% endif %}>Salary</option>
                            <option value="Bills" {% if selected_category == "Bills" %}selected{% endif %}>Bills</option>
                            <option value="Transport" {% if selected_category == "Transport" %}selected{% endif %}>Transport</option>
                            <option value="Other" {% if selected_category == "Other" %}selected{% endif %}>Other</option>
                        </select>
                    </div>

                    <div class="col-md-3">
                        <label class="form-label">From</label>
                        <input type="date" class="form-control" name="start_date" value="{{ start_date }}">
                    </div>

                    <div class="col-md-3">
                        <label class="form-label">To</label>
                        <input type="date" class="form-control" name="end_date" value="{{ end_date }}">
                    </div>

                    <div class="col-md-3 d-grid gap-2">
                        <button type="submit" class="btn btn-primary">Filter</button>
                        <a href="{% url 'home' %}" class="btn btn-secondary">Reset</a>
                        <a href="{% url 'export_csv' %}?category={{ selected_category }}&start_date={{ start_date }}&end_date={{ end_date }}" class="btn btn-outline-dark">Export CSV</a>

                    </div>
                </form>
            </div>
        </div>

        <!-- Summary -->
        <div class="row text-center mb-4">
            <div class="col-md-4">
                <div class="card text-white bg-success mb-3">
                    <div class="card-body">
                        <h5 class="card-title">Income</h5>
                        <p class="card-text fs-4">üíµ {{ total_income }}</p>
                    </div>
                </div>
            </div>
            <div class="col-md-4">
                <div class="card text-white bg-danger mb-3">
                    <div class="card-body">
                        <h5 class="card-title">Expenses</h5>
                        <p class="card-text fs-4">üßæ {{ total_expense }}</p>
                    </div>
                </div>
            </div>
            <div class="col-md-4">
                <div class="card text-white bg-primary mb-3">
                    <div class="card-body">
                        <h5 class="card-title">Balance</h5>
                        <p class="card-text fs-4">üü¢ {{ balance }}</p>
                    </div>
                </div>
            </div>
        </div>

        <!-- Add Transaction -->
        <div class="mb-3 text-end">
            <a href="{% url 'add_transaction' %}" class="btn btn-success">+ Add Transaction</a>
        </div>

        <!-- Transaction List -->
        <div class="card mb-4">
            <div class="card-body">
                <h5 class="card-title">All Transactions</h5>
                {% if transactions %}
                    <ul class="list-group">
                        {% for txn in transactions %}
                            <li class="list-group-item d-flex justify-content-between align-items-center">
                                <div>
                                    <strong>{{ txn.description }}</strong> ({{ txn.category }})<br>
                                    <small class="text-muted">{{ txn.date|date:"Y-m-d H:i" }}</small>
                                </div>
                                <div>
                                    <span class="fw-bold">{{ txn.amount }}</span>
                                    <a href="{% url 'edit_transaction' txn.id %}" class="btn btn-sm btn-outline-primary ms-2">Edit</a>
                                    <a href="{% url 'delete_transaction' txn.id %}" class="btn btn-sm btn-outline-danger ms-2">Delete</a>
                                </div>
                            </li>
                        {% endfor %}
                    </ul>
                {% else %}
                    <p>No transactions found.</p>
                {% endif %}
            </div>
        </div>

        <!-- Chart -->
        <div class="card mb-4">
            <div class="card-body">
                <h5 class="card-title">üìä Expenses by Category</h5>
                <canvas id="expenseChart" width="400" height="400"></canvas>
            </div>
        </div>
    </div>

    <script>
        const ctx = document.getElementById('expenseChart').getContext('2d');
        const expenseChart = new Chart(ctx, {
            type: 'pie',
            data: {
                labels: {{ chart_labels|safe }},
                datasets: [{
                    label: 'Expenses by Category',
                    data: {{ chart_data|safe }},
                    backgroundColor: [
                        '#FF6384', '#36A2EB', '#FFCE56', '#4BC0C0', '#9966FF', '#FF9F40'
                    ],
                    borderWidth: 1
                }]
            },
            options: {
                responsive: true,
                plugins: {
                    legend: {
                        position: 'right'
                    }
                }
            }
        });
    </script>

    <!-- Dark Mode -->
    <script>
    const toggleBtn = document.getElementById('toggle-theme');
    const body = document.body;

    // Check preference
    if (localStorage.getItem("theme") === "dark") {
        body.classList.add("bg-dark", "text-white");
    }

    toggleBtn.addEventListener("click", () => {
        body.classList.toggle("bg-dark");
        body.classList.toggle("text-white");

        // Save preference
        if (body.classList.contains("bg-dark")) {
            localStorage.setItem("theme", "dark");
            toggleBtn.innerText = "‚òÄÔ∏è Light Mode";
        } else {
            localStorage.setItem("theme", "light");
            toggleBtn.innerText = "üåô Dark Mode";
        }
    });
</script>

</body>
</html>
